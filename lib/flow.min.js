var FILE_ENCODING="utf-8",EOL="\n",_fs=require("fs"),exec=require("child_process").exec,util=require("util"),Flow={};typeof exports!="undefined"&&(exports=module.exports=function(path){return Flow.path=path,Flow}),Flow.compile={},Flow.compile.Jade=function(o){o=o||{};var calledDir=o.calledDir||!1,input=o.input||!1,output=o.output||!1,command=Flow.path.markx+" "+calledDir+input+" > "+calledDir+output;exec(command,function(error,stdout,stderr){error!==null&&console.log("exec error: "+error)})},Flow.compile.Js=function(o){o=o||{};var calledDir=o.calledDir||!1,destination=o.destination||!1,frameworks=o.frameworks||!1,input=o.input||!1,list,output=o.output||!1,src=o.src||!1;if(src){var srcList=src.map(function(srcItem){return calledDir+srcItem});frameworks?list=frameworks.concat(srcList):list=srcList;var out=list.map(function(item){return _fs.readFileSync(item,FILE_ENCODING)});_fs.writeFileSync(destination,out.join(EOL),FILE_ENCODING)}if(input&&output){var file=_fs.readFileSync(calledDir+input,FILE_ENCODING);_fs.writeFileSync(calledDir+output,file,FILE_ENCODING)}},Flow.compiler=function(){var calledDir=Flow.path.called,configPath=calledDir+"/flow.json",config=require(configPath),destination=config.destination||!1,files=config.files||!1,filetype,input,output;destination&&(destination=calledDir+destination),Flow.compile.Js({calledDir:calledDir,destination:destination||!1,frameworks:config.frameworks||!1,src:config.src||!1});if(files)for(file in files){input=file.toString(),output=files[file].toString(),filetype=input.substr(input.lastIndexOf(".")+1);switch(filetype){case"jade":Flow.compile.Jade({calledDir:calledDir,input:input,output:output});break;case"js":Flow.compile.Js({calledDir:calledDir,destination:destination,input:input,output:output});default:}}}