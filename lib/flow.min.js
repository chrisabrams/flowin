var FILE_ENCODING="utf-8",EOL="\n",_fs=require("fs"),exec=require("child_process").exec,util=require("util"),Flow={};typeof exports!="undefined"&&(exports=module.exports=function(path){return Flow.path=path,Flow}),Flow.compile=function(o){o=o||{};var calledDir=o.calledDir||!1,files=o.files||[],frameworks,list,minify,out,output,src,srcList,type=o.type||!1;if(calledDir&&files&&type)switch(type){case"html":files.forEach(function(file,key){output=file.output||!1,src=file.src||!1;if(output&&src){var command=Flow.path.markx+" "+calledDir+src+" > "+calledDir+output;exec(command,function(error,stdout,stderr){error!==null&&console.log("exec error: "+error)})}});break;case"js":files.forEach(function(file,key){frameworks=file.frameworks||!1,output=file.output||!1,src=file.src||!1,output&&src&&(srcList=src.map(function(srcItem){return calledDir+srcItem}),frameworks?list=frameworks.concat(srcList):list=srcList,out=list.map(function(item){return _fs.readFileSync(item,FILE_ENCODING)}),_fs.writeFileSync(calledDir+output,out.join(EOL),FILE_ENCODING))})}},Flow.watch=function(o){o=o||{};var file=o.file||!1;file&&_fs.watch(file,{persistant:!0},function(ev,file){Flow.compiler({watch:!1})})},Flow.compiler=function(o){o=o||{};var watch=o.watch||!0,fileList=[],calledDir=Flow.path.called,configPath=calledDir+"/flow.json",config=require(configPath),project=config.project||!1;if(project){var css=project.css||!1,html=project.html||!1,js=project.js||!1;!css,html&&html.files&&(Flow.compile({calledDir:calledDir,files:html.files,type:"html"}),html.files.forEach(function(file,key){file.src.forEach(function(){fileList.push(file.toString())})})),js&&js.files&&(Flow.compile({calledDir:calledDir,files:js.files,type:"js"}),js.files.forEach(function(file,key){file.src.forEach(function(file,key){fileList.push(file.toString())})}))}watch&&fileList.forEach(function(val,key){Flow.watch({file:calledDir+val})})}